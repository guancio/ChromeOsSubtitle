/*
 JSON/XML-RPC Client <http://code.google.com/p/json-xml-rpc/>
 Version: 0.8.0.2 (2007-12-06)
 Copyright: 2007, Weston Ruter <http://weston.ruter.net/>
 License: Dual licensed under MIT <http://creativecommons.org/licenses/MIT/>
          and GPL <http://creativecommons.org/licenses/GPL/2.0/> licenses.
*/
var rpc={version:'0.8.0.2',requestCount:0,ServiceProxy:function(a,b){this.__serviceURL=a;this.__isCrossSite=!1;var d=this.__serviceURL.match(/^(\w+:)\/\/([^\/]+?)(?::(\d+))?(?:$|\/)/);d&&(this.__isCrossSite=location.protocol!=d[1]||document.domain!=d[2]||location.port!=(d[3]||''));this.__isCrossSite=!1;var c;this.__isResponseSanitized=this.__isAsynchronous=!0;this.__authPassword=this.__authUsername=null;this.__callbackParamName='JSON-response-callback';this.__protocol='JSON-RPC';this.__dateEncoding=
'ISO8601';this.__decodeISO8601=!0;if(b instanceof Object){if(void 0!==b.asynchronous&&(this.__isAsynchronous=!!b.asynchronous,!this.__isAsynchronous&&this.__isCrossSite))throw Error('It is not possible to establish a synchronous connection to a cross-site RPC service.');void 0!=b.sanitize&&(this.__isResponseSanitized=!!b.sanitize);void 0!=b.user&&(this.__authUsername=b.user);void 0!=b.password&&(this.__authPassword=b.password);void 0!=b.callbackParamName&&(this.__callbackParamName=b.callbackParamName);
'XML-RPC'==String(b.protocol).toUpperCase()&&(this.__protocol='XML-RPC');void 0!=b.dateEncoding&&(this.__dateEncoding=b.dateEncoding);void 0!=b.decodeISO8601&&(this.__decodeISO8601=!!b.decodeISO8601);c=b.methods}if(this.__isCrossSite){if(this.__isResponseSanitized)throw Error("You are attempting to access a service on another site, and the JSON data returned by cross-site requests cannot be sanitized. You must therefore explicitly set the 'sanitize' option to false (it is true by default) in order to proceed with making potentially insecure cross-site rpc calls.");
if('XML-RPC'==this.__protocol)throw Error('Unable to use the XML-RPC protocol to access services on other domains.');}if(this.__isCrossSite&&!c)throw Error("You must manually supply the service's method names since auto-introspection is not permitted for cross-site services.");c?this.__methodList=c:(d=this.__isAsynchronous,this.__isAsynchronous=!1,this.__methodList=this.__callMethod('system.listMethods',[]),this.__isAsynchronous=d);this.__methodList.push('system.listMethods');this.__methodList.push('system.describe');
for(var e,d=0;e=this.__methodList[d];d++){c=this;for(var f=e.split(/\./),h=0;h+1<f.length;h++)c[f[h]]||(c[f[h]]={}),c=c[f[h]];e=function(a,b){return function(){if(a.__isAsynchronous)1==arguments.length&&arguments[0]instanceof Object?a.__callMethod(b,arguments[0].params,arguments[0].onSuccess,arguments[0].onException,arguments[0].onComplete):a.__callMethod(b,arguments[0],arguments[1],arguments[2],arguments[3]);else return a.__callMethod(b,rpc.toArray(arguments))}}(this,e);c[f[f.length-1]]=e}},setAsynchronous:function(a,
b){if(!b&&a.__isCrossSite)throw Error('It is not possible to establish a synchronous connection to a cross-site RPC service.');a.__isAsynchronous=!!b}};
rpc.ServiceProxy.prototype.__callMethod=function(a,b,d,c,e){rpc.requestCount++;if(this.__isAsynchronous){if(d&&'function'!=typeof d)throw Error('The asynchronous onSuccess handler callback function you provided is invalid; the value you provided ('+d.toString()+') is of type "'+typeof d+'".');if(c&&'function'!=typeof c)throw Error('The asynchronous onException handler callback function you provided is invalid; the value you provided ('+c.toString()+') is of type "'+typeof c+'".');if(e&&'function'!=
typeof e)throw Error('The asynchronous onComplete handler callback function you provided is invalid; the value you provided ('+e.toString()+') is of type "'+typeof e+'".');}try{if(this.__isAsynchronous||this.__isCrossSite)rpc.pendingRequests[String(rpc.requestCount)]={onSuccess:d,onException:c,onComplete:e};if(this.__isCrossSite){rpc.callbacks['r'+String(rpc.requestCount)]=function(a,b){return function(c){c instanceof Object&&(c.result||c.error)?(c.id=b,a.__doCallback(c)):a.__doCallback({id:b,result:c})}}(this,
rpc.requestCount);var f=document.createElement('script');f.setAttribute('type','text/javascript');var h=this.__serviceURL+'/'+a+'?'+this.__callbackParamName+'=rpc.callbacks.r'+rpc.requestCount;b&&(h+='&'+rpc.toQueryString(b));f.setAttribute('src',h);f.setAttribute('id','rpc'+rpc.requestCount);var m=document.getElementsByTagName('head')[0];rpc.pendingRequests[rpc.requestCount].scriptElement=f;m.appendChild(f)}else{if(b&&(!(b instanceof Object)||b instanceof Date))throw Error('When making asynchronous calls, the parameters for the method must be passed as an array (or a hash); the value you supplied ('+
String(b)+') is of type "'+typeof b+'".');var p,n;if('XML-RPC'==this.__protocol){d=['<?xml version="1.0"?><methodCall><methodName>'+a+'</methodName>'];if(b){if(!(b instanceof Array))throw Error('Unable to pass associative arrays to XML-RPC services.');d.push('<params>');for(f=0;f<b.length;f++)d.push('<param>'+this.__toXMLRPC(b[f])+'</param>');d.push('</params>')}d.push('</methodCall>');n=d.join('')}else p={version:'1.1',method:a,id:rpc.requestCount},b&&(p.params=b),n=this.__toJSON(p);var g;if(window.XMLHttpRequest)g=
new XMLHttpRequest;else if(window.ActiveXObject)try{g=new ActiveXObject('Msxml2.XMLHTTP')}catch(q){g=new ActiveXObject('Microsoft.XMLHTTP')}g.open('POST',this.__serviceURL,this.__isAsynchronous,this.__authUsername,this.__authPassword);'XML-RPC'==this.__protocol?(g.setRequestHeader('Content-Type','text/xml'),g.setRequestHeader('Accept','text/xml')):(g.setRequestHeader('Content-Type','application/json'),g.setRequestHeader('Accept','application/json'));if(this.__isAsynchronous){g.send(n);var l=this,
r=rpc.requestCount;g.onreadystatechange=function(){if(4==g.readyState){if('XML-RPC'==l.__protocol)var a=l.__getXMLRPCResponse(g,r);else a=l.__evalJSON(g.responseText,l.__isResponseSanitized),a.id||(a.id=r);l.__doCallback(a)}};}else{g.send(n);var k;k='XML-RPC'==this.__protocol?this.__getXMLRPCResponse(g,rpc.requestCount):this.__evalJSON(g.responseText,this.__isResponseSanitized);if(k.error)throw Error('Unable to call "'+a+'". Server responsed with error (code '+k.error.code+'): '+k.error.message);this.__upgradeValuesFromJSON(k);
return k.result}}}catch(q){if(a=!1,c&&(a=c(q)),e&&e(),!a)throw q;}};rpc.pendingRequests={};rpc.callbacks={};
rpc.ServiceProxy.prototype.__doCallback=function(a){if('object'!=typeof a)throw Error('The server did not respond with a response object.');if(!a.id)throw Error('The server did not respond with the required response id for asynchronous calls.');if(!rpc.pendingRequests[a.id])throw Error('Fatal error with RPC code: no ID "'+a.id+'" found in pendingRequests.');if(rpc.pendingRequests[a.id].scriptElement){var b=rpc.pendingRequests[a.id].scriptElement;b.parentNode.removeChild(b)}rpc.callbacks[a.id]&&delete rpc.callbacks['r'+
a.id];b=[];if(void 0!==a.error){var d=Error(a.error.message);d.code=a.error.code;if(rpc.pendingRequests[a.id].onException)try{rpc.pendingRequests[a.id].onException(d)||b.push(d)}catch(e){b.push(d),b.push(e)}else b.push(d)}else if(void 0!==a.result&&(this.__upgradeValuesFromJSON(a),rpc.pendingRequests[a.id].onSuccess))try{rpc.pendingRequests[a.id].onSuccess(a.result)}catch(e){if(rpc.pendingRequests[a.id].onException)try{rpc.pendingRequests[a.id].onException(e)||b.push(e)}catch(f){b.push(e),b.push(f)}else b.push(e)}try{if(rpc.pendingRequests[a.id].onComplete)rpc.pendingRequests[a.id].onComplete(a)}catch(e){if(rpc.pendingRequests[a.id].onException)try{rpc.pendingRequests[a.id].onException(e)||
b.push(e)}catch(f){b.push(e),b.push(f)}else b.push(e)}delete rpc.pendingRequests[a.id];if(b.length){var c;a='There '+(1==b.length?'was 1 uncaught exception':'were '+b.length+' uncaught exceptions')+': ';for(d=0;d<b.length;d++)d&&(a+='; '),a+=b[d].message,b[d].code&&(c=b[d].code);d=Error(a);d.code=c;throw d;}};
rpc.ServiceProxy.prototype.__toJSON=function(a){switch(typeof a){case 'number':return isFinite(a)?a.toString():'null';case 'boolean':return a.toString();case 'string':var b={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\','/':'/'};return'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];if(d)return d;d=c.charCodeAt();return'\\u00'+rpc.zeroPad(d.toString(16))})+'"';case 'object':if(null===a)return'null';if(a instanceof Array){for(var d=['['],c=0;c<a.length;c++)c&&
d.push(','),d.push(this.__toJSON(a[c]));d.push(']');return d.join('')}if(a instanceof Date)switch(this.__dateEncoding){case 'classHinting':return'{"__jsonclass__":["Date",['+a.valueOf()+']]}';case '@timestamp@':case '@ticks@':return'"@'+a.valueOf()+'@"';case 'ASP.NET':return'"\\/Date('+a.valueOf()+')\\/"';default:return'"'+rpc.dateToISO8601(a)+'"'}else{if(a instanceof Number||a instanceof String||a instanceof Boolean)return this.__toJSON(a.valueOf());var c={}.hasOwnProperty?!0:!1,d=['{'],e;for(e in a)if(!c||
a.hasOwnProperty(e))1<d.length&&d.push(','),d.push(this.__toJSON(e)+':'+this.__toJSON(a[e]));d.push('}');return d.join('')}}throw new TypeError('Unable to convert the value of type "'+typeof a+'" to JSON.');};rpc.isJSON=function(a){a=a.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(a)};
rpc.ServiceProxy.prototype.__evalJSON=function(a,b){a=a.replace(/^\/\*-secure-([\s\S]*)\*\/\s*$/,'$1');var d;try{if(!b||rpc.isJSON(a))return eval('('+a+')')}catch(c){d=c}throw new SyntaxError('Badly formed JSON string: '+a+' ... '+(d?d.message:''));};
rpc.ServiceProxy.prototype.__upgradeValuesFromJSON=function(a){var b,d={}.hasOwnProperty?!0:!1,c;for(c in a)if(!d||a.hasOwnProperty(c))if('string'==typeof a[c])if(this.__decodeISO8601&&(b=a[c].match(/^(?:(\d\d\d\d)-(\d\d)(?:-(\d\d)(?:T(\d\d)(?::(\d\d)(?::(\d\d)(?:\.(\d+))?)?)?)?)?)$/)))a[c]=new Date(0),b[1]&&a[c].setUTCFullYear(parseInt(b[1])),b[2]&&a[c].setUTCMonth(parseInt(b[2]-1)),b[3]&&a[c].setUTCDate(parseInt(b[3])),b[4]&&a[c].setUTCHours(parseInt(b[4])),b[5]&&a[c].setUTCMinutes(parseInt(b[5])),
b[6]&&a[c].setUTCMilliseconds(parseInt(b[6]));else if(b=a[c].match(/^@(\d+)@$/))a[c]=new Date(parseInt(b[1]));else{if(b=a[c].match(/^\/Date\((\d+)\)\/$/))a[c]=new Date(parseInt(b[1]))}else a[c]instanceof Object&&(a[c].__jsonclass__ instanceof Array?'Date'==a[c].__jsonclass__[0]&&(a[c]=a[c].__jsonclass__[1]instanceof Array&&a[c].__jsonclass__[1][0]?new Date(a[c].__jsonclass__[1][0]):new Date):this.__upgradeValuesFromJSON(a[c]))};
rpc.ServiceProxy.prototype.__toXMLRPC=function(a){var b=['<value>'];switch(typeof a){case 'number':isFinite(a)?parseInt(a)==Math.ceil(a)?(b.push('<int>'),b.push(a.toString()),b.push('</int>')):(b.push('<double>'),b.push(a.toString()),b.push('</double>')):b.push('<nil/>');break;case 'boolean':b.push('<boolean>');b.push(a?'1':'0');b.push('</boolean>');break;case 'string':b.push('<string>');b.push(a.replace(/[<>&]/,function(a){}));b.push('</string>');break;case 'object':if(null===a)b.push('<nil/>');
else if(a instanceof Array){b.push('<array><data>');for(var d=0;d<a.length;d++)b.push(this.__toXMLRPC(a[d]));b.push('</data></array>')}else if(a instanceof Date)b.push('<dateTime.iso8601>'+rpc.dateToISO8601(a)+'</dateTime.iso8601>');else{if(a instanceof Number||a instanceof String||a instanceof Boolean)return rpc.dateToISO8601(a.valueOf());b.push('<struct>');var d={}.hasOwnProperty?!0:!1,c;for(c in a)if(!d||a.hasOwnProperty(c))b.push('<member>'),b.push('<name>'+c+'</name>'),b.push(this.__toXMLRPC(a[c])),
b.push('</member>');b.push('</struct>')}break;default:throw new TypeError('Unable to convert the value of type "'+typeof a+'" to XML-RPC.');}b.push('</value>');return b.join('')};
rpc.ServiceProxy.prototype.__parseXMLRPC=function(a){if(1==a.childNodes.length&&3==a.childNodes.item(0).nodeType)return a.childNodes.item(0).nodeValue;for(var b=0;b<a.childNodes.length;b++)if(1==a.childNodes.item(b).nodeType)switch(b=a.childNodes.item(b),b.nodeName.toLowerCase()){case 'i4':case 'int':a=parseInt(b.firstChild.nodeValue);if(isNaN(a))throw Error("XML-RPC Parse Error: The value provided as an integer '"+b.firstChild.nodeValue+"' is invalid.");return a;case 'double':a=parseFloat(b.firstChild.nodeValue);
if(isNaN(a))throw Error("XML-RPC Parse Error: The value provided as a double '"+b.firstChild.nodeValue+"' is invalid.");return a;case 'boolean':if('0'!=b.firstChild.nodeValue&&'1'!=b.firstChild.nodeValue)throw Error("XML-RPC Parse Error: The value provided as a boolean '"+b.firstChild.nodeValue+"' is invalid.");return!!parseInt(b.firstChild.nodeValue);case 'string':return b.firstChild?b.firstChild.nodeValue:'';case 'datetime.iso8601':a=new Date(0);if(b=b.firstChild.nodeValue.match(/^(?:(\d\d\d\d)-(\d\d)(?:-(\d\d)(?:T(\d\d)(?::(\d\d)(?::(\d\d)(?:\.(\d+))?)?)?)?)?)$/))return b[1]&&
a.setUTCFullYear(parseInt(b[1])),b[2]&&a.setUTCMonth(parseInt(b[2]-1)),b[3]&&a.setUTCDate(parseInt(b[3])),b[4]&&a.setUTCHours(parseInt(b[4])),b[5]&&a.setUTCMinutes(parseInt(b[5])),b[6]&&a.setUTCMilliseconds(parseInt(b[6])),a;throw Error('XML-RPC Parse Error: The provided value does not match ISO8601.');case 'base64':throw Error('Not able to parse base64 data yet.');case 'nil':return null;case 'struct':for(var d={},c,e=0;c=b.childNodes.item(e);e++)if(1==c.nodeType&&'member'==c.nodeName){var f='';a=
null;for(var h,m=0;h=c.childNodes.item(m);m++)1==h.nodeType&&('name'==h.nodeName?f=h.firstChild.nodeValue:'value'==h.nodeName&&(a=h));f&&a&&(d[f]=this.__parseXMLRPC(a))}return d;case 'array':d=[];for(b=b.firstChild;b&&(1!=b.nodeType||'data'!=b.nodeName);)b=b.nextSibling;b||Error("XML-RPC Parse Error: Expected 'data' element as sole child element of 'array'.");for(a=b.firstChild;a;){if(1==a.nodeType)if('value'==a.nodeName)d.push(this.__parseXMLRPC(a));else throw Error("XML-RPC Parse Error: Illegal element child '"+
a.nodeName+"' of an array's 'data' element.");a=a.nextSibling}return d;default:throw Error("XML-RPC Parse Error: Illegal element '"+b.nodeName+"' child of the 'value' element.");}return''};
rpc.ServiceProxy.prototype.__getXMLRPCResponse=function(a,b){var d={};if(!a.responseXML)throw Error('Malformed XML document.');var c=a.responseXML.documentElement;if('methodResponse'!=c.nodeName)throw Error('Invalid XML-RPC document.');c=c.getElementsByTagName('value')[0];if('param'==c.parentNode.nodeName&&'params'==c.parentNode.parentNode.nodeName)d.result=this.__parseXMLRPC(c);else if('fault'==c.parentNode.nodeName)c=this.__parseXMLRPC(c),d.error={code:c.faultCode,message:c.faultString};else throw Error('Invalid XML-RPC document.');
if(!d.result&&!d.error)throw Error('Malformed XML-RPC methodResponse document.');d.id=b;return d};
rpc.toQueryString=function(a){if(!(a instanceof Object||a instanceof Array)||a instanceof Date)throw Error('You must supply either an array or object type to convert into a query string. You supplied: '+a.constructor);var b='',d={}.hasOwnProperty?!0:!1,c;for(c in a)if(d&&a.hasOwnProperty(c))if(a[c]instanceof Array)for(var e=0;e<a[c].length;e++)if(b&&(b+='&'),b+=encodeURIComponent(c)+'=',a[c][e]instanceof Date)b+=encodeURIComponent(rpc.dateToISO8601(a[c][e]));else{if(a[c][e]instanceof Object)throw Error('Unable to pass nested arrays nor objects as parameters while in making a cross-site request. The object in question has this constructor: '+
a[c][e].constructor);b+=encodeURIComponent(String(a[c][e]))}else if(b&&(b+='&'),b+=encodeURIComponent(c)+'=',a[c]instanceof Date)b+=encodeURIComponent(rpc.dateToISO8601(a[c]));else{if(a[c]instanceof Object)throw Error('Unable to pass objects as parameters while in making a cross-site request. The object in question has this constructor: '+a[c].constructor);b+=encodeURIComponent(String(a[c]))}return b};
rpc.toArray=function(a){if(a instanceof Array)return a;for(var b=[],d=0;d<a.length;d++)b.push(a[d]);return b};rpc.dateToISO8601=function(a){return a.getUTCFullYear()+'-'+rpc.zeroPad(a.getUTCMonth()+1)+'-'+rpc.zeroPad(a.getUTCDate())+'T'+rpc.zeroPad(a.getUTCHours())+':'+rpc.zeroPad(a.getUTCMinutes())+':'+rpc.zeroPad(a.getUTCSeconds())+'.'+rpc.zeroPad(a.getUTCMilliseconds(),3)};rpc.zeroPad=function(a,b){b||(b=2);for(a=void 0==a?'':String(a);a.length<b;)a='0'+a;return a};
